<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Clinical Trial Simulation • ruminate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Clinical Trial Simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ruminate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="external-link nav-link" href="https://runruminate.ubiquity.tools/"><span class="fa fas fa-cloud"></span> Try Online</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-videos" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-video"></span> Videos</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-videos">
<li><a class="external-link dropdown-item" href="https://vimeo.com/1042510561">Workflow Example</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorial" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-chalkboard-teacher"></span> Tutorial</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorial">
<li><a class="dropdown-item" href="../articles/deployment.html">Deployment &amp; Customization</a></li>
    <li><a class="dropdown-item" href="../articles/noncompartmental_analysis.html">Non-Compartmental Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/model_builder.html">Building Models</a></li>
    <li><a class="dropdown-item" href="../articles/clinical_trial_simulation.html">Clinical Trial Simulations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-hat-wizard"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/john-harrold/ruminate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Clinical Trial Simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/ruminate/blob/HEAD/vignettes/clinical_trial_simulation.Rmd" class="external-link"><code>vignettes/clinical_trial_simulation.Rmd</code></a></small>
      <div class="d-none name"><code>clinical_trial_simulation.Rmd</code></div>
    </div>

    
    
<p><strong><em>NOTE: This module is currently under active development
and this documentation is a work in progress</em></strong></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Normally when we want to simulate a patients response we define a
regimen and just simulate forward to a specified point in time. This
works well for compounds that are relatively safe, the PK is consistent
over time, and for which the drug concentrations required to achieve
efficacy are consistent. In fact these restrictions apply to many
different compounds. However, there are many scenarios where it is
necessary to adjust dosing based on periodic clinical visits: compounds
with a narrow therapeutic index, disease progression which alters the
drug PK or requires increases in the dose amount, etc. While it is
possible to do this manually with the current simulation tools provided,
this section outlines a generalized framework to make this easier for
the users.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The underlying simulations are run using <code>rxode2</code>, and as
such we need an <code>rxode2</code> system object. From that we can
either simulate subjects or load them from a file. Next we need to
define a set of rules. These will be a set of conditions and actions. At
each evaluation time point the conditions are evaluated. When a
condition is met the actions associated with that condition are
executed. For example, if during a visit (an evaluation time point) the
trough PK is below a certain level (condition) we may want to increase
the dosing regimen for the next dosing cycle (action).</p>
<div class="section level3">
<h3 id="creating-subjects">Creating subjects<a class="anchor" aria-label="anchor" href="#creating-subjects"></a>
</h3>
<p>Subjects are expected in a data frame with the following column
headers:</p>
<ul>
<li>
<code>id</code> Individual subject id</li>
<li>Names of parameters and iiv as specified in the <code>ini</code>
section of the <code>rxode2</code> function specification</li>
<li>Names of covariates used in the model.</li>
</ul>
<p><code><a href="../reference/mk_subjects.html">mk_subjects()</a></code> — Creates subjects for simulation by
sampling based on between-subject variability and generating covariate
information based on user specifications.</p>
<div class="section level4">
<h4 id="covariates">Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h4>
<p>The <code>covs</code> input is a list with the following
structure:</p>
<ul>
<li>type: Can be either “fixed”, “discrete”, or “continuous”.</li>
<li>sampling: This field is only needed for a “continuous” covariate ’
type and can be either “random”, “normal” or “log-normal”.</li>
<li>values: This field depends on the type and optional sampling above.
<ul>
<li>fixed: A single value.</li>
<li>discrete: A vector of possible discrete elements.</li>
<li>continuous, random: Two values the first is the lower bound and the
second is the upper bound.</li>
<li>continuous, normal: Two values the first is the mean and the second
is the variance.</li>
<li>continuous, log-normal: Two values the first is the mean and the
second is the variance.</li>
</ul>
</li>
</ul>
<p>This examples shows the <code>SEX_ID</code> randomly sampled from the
values specified, <code>SUBTYPE_ID</code> fixed at a value, and
<code>WT</code> sampled from a log-normal distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  SEX_ID     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type     <span class="op">=</span> <span class="st">"discrete"</span>, </span>
<span>                    values   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  SUBTYPE_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type     <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    values   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  WT         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type     <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>                    sampling <span class="op">=</span> <span class="st">"log-normal"</span>,</span>
<span>                    values   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70</span>, <span class="fl">.15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="rule-based-simulations">Rule-based simulations<a class="anchor" aria-label="anchor" href="#rule-based-simulations"></a>
</h3>
<p><code><a href="../reference/simulate_rules.html">simulate_rules()</a></code> — This will run simulations based on
the rule definitions below.</p>
<div class="section level4">
<h4 id="rules">Rules<a class="anchor" aria-label="anchor" href="#rules"></a>
</h4>
<p>Rules are a named list where the list name can be a short descriptive
label used to remember what the rule does. These names will be returned
as columns in the simulated data frame.</p>
<ul>
<li>
<code>condition</code>: Character string that evaluates to either
<code>TRUE</code> or <code>FALSE</code>. When true the
<code>action</code> portion will be triggered. For a list of objects
available see the Rule-evaluation environment below.</li>
<li>
<code>fail_flag</code>: Flag set in the <code>rule_id</code> column
when the condition is not met (set to <code>"false"</code> if not
specified).</li>
<li>
<code>true_flag</code>: Flag set in the <code>rule_id</code> column
when the condition is met (set to <code>"true"</code> if not
specified).</li>
<li>
<code>action</code>: This is what the rule will trigger can be any
of the following:
<ul>
<li>
<code>type</code>: This defines the action type and can be either
<code>"dose"</code>, <code>"set state"</code>, or
<code>"manual"</code>.</li>
</ul>
</li>
</ul>
<p>Based on the <code>type</code> the <code>action</code> field will
expect different elements.</p>
<p>Dosing:</p>
<ul>
<li>
<code>action</code>
<ul>
<li>
<code>type</code>: <code>"dose"</code>
</li>
<li>
<code>values</code>: Character string that evaluates as a numeric
vector dosing amounts (e.g. <code>"c(3,  3,  3,  3)"</code>)</li>
<li>
<code>times</code>: Character string that evaluates as a numeric
vector of times (e.g. <code>"c(0, 14, 28, 42)"</code>)</li>
<li>
<code>durations</code>: Character string that evaluates as a numeric
vector of durations (e.g. <code>"c(0, 0, 0, 0)"</code>, zero for bolus
dosing)</li>
</ul>
</li>
</ul>
<p>Changing a state value:</p>
<ul>
<li>
<code>action</code>
<ul>
<li>
<code>type</code>: <code>"set state"</code>
</li>
<li>
<code>state</code>: Character string with the name of the state to
set (<code>"Ac"</code>)</li>
<li>
<code>value</code>: Character string that evaluates as a numeric
value for state (e.g. <code>"Ac/2"</code> would set the state to half
the value of Ac at the evaluation point)</li>
</ul>
</li>
</ul>
<p>Manual modification of the simulation:</p>
<ul>
<li>
<code>action</code>
<ul>
<li>
<code>type</code>: <code>"manual"</code>
</li>
<li>
<code>code</code>: Character string of code to evaluate.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="rule-evaluation-environment">Rule-evaluation environment<a class="anchor" aria-label="anchor" href="#rule-evaluation-environment"></a>
</h4>
<p>Beyond simple simulations it will be necessary to execute actions
based on the current or previous state of the system. For this reason,
when a <code>condition</code> or elements of the action (e.g., the
<code>values</code>, <code>times</code> and <code>durations</code> of a
dose action type) are being evaluated, the following objects will be
available at each evaluation point:</p>
<ul>
<li>outputs: The value of each model output.</li>
<li>states: The value of each named state or compartment.</li>
<li>covariates: The value of each named covariate.</li>
<li>subject-level parameters: The value of each named parameter.</li>
<li>rule value: The last value the rule evaluated as.</li>
<li>
<code>id</code>: Current subject id.</li>
<li>
<code>time</code>: Current evaluation time.</li>
<li>
<code>SI_SUB_HISTORY</code>: A data frame of the simulation history
of the current subject up to the current evaluation point.</li>
<li>
<code>SI_subjects</code>: The subjects data frame.</li>
<li>
<code>SI_eval_times</code>: Vector of the evaluation times.</li>
<li>
<code>SI_interval_ev</code>: The events table in it’s current state
for the given simulation interval.</li>
<li>
<code>SI_ev_history</code>: This is the history of the event table
containing all the events leading up to the current interval.</li>
<li>
<code>SI_ud_history</code>: This is a free form object the user can
define or alter within the “manual”action type (ud-user defined,
history).</li>
</ul>
<div class="section level5">
<h5 id="the-following-functions-will-be-available">The following functions will be available:<a class="anchor" aria-label="anchor" href="#the-following-functions-will-be-available"></a>
</h5>
<ul>
<li>
<code>SI_fpd</code>: This function will fetch the previous dose
(fpd) for the given id and state. For example for the current
<code>id</code> and the state <code>Ac</code> you would do the
following:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SI_fpd</span><span class="op">(</span>id<span class="op">=</span><span class="va">id</span>, state<span class="op">=</span><span class="st">"Ac"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="time-scales">Time scales<a class="anchor" aria-label="anchor" href="#time-scales"></a>
</h4>
<p>You can include columns in your output for different time scales if
you wish. You need to create a list in the format below. One element
should be <code>system</code> with a short name for the system time
scale. The next should be <code>details</code> which is a list
containing short names for each time scale you want to include. Each of
these is a list with a verbose name for the time scale
(<code>verb</code>) and a numerical conversion indicating how that time
scale relates to the others. Here we define weeks and days on the basis
of seconds.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_scales</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>system<span class="op">=</span><span class="st">"days"</span>, </span>
<span>                details<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  weeks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verb<span class="op">=</span><span class="st">"Weeks"</span>,    conv<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">*</span><span class="fl">24</span><span class="op">*</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  days  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verb<span class="op">=</span><span class="st">"Days"</span>,     conv<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-fixed-dosing">Example: Fixed dosing<a class="anchor" aria-label="anchor" href="#example-fixed-dosing"></a>
</h2>
<p>To explore this framework a simple system describing antibody PK
driving a change in a biomarker through an indirect response will be
used. The time scale of this model is days and the system is shown at
the bottom if you want to look through it. You can also find it in the
<code>{rumiante}</code> package here:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"ruminate"</span>, <span class="st">"test_apps"</span>, <span class="st">"test_rxode2_system.R"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="creating-the-rxode2-object">Creating the <code>rxode2</code> object<a class="anchor" aria-label="anchor" href="#creating-the-rxode2-object"></a>
</h3>
<p>If you source the example file above it will create the function
<code>my_model</code>. We can then we convert it into an
<code>rxode2</code> object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"ruminate"</span>, <span class="st">"test_apps"</span>, <span class="st">"test_rxode2_system.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">object</span> <span class="op">=</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-subjects">Defining subjects<a class="anchor" aria-label="anchor" href="#defining-subjects"></a>
</h3>
<p>The first thing you want to do is create subjects. You can do this
using the interindividual variability in the system. For systems where
there are covariates you will need to define those. In this example
there are three covariates that are needed. This list will create those
by sampling <code>SEX_ID</code> randomly from a discrete distribution,
fixing the <code>SUBTYPE_ID</code> at 0, and sampling the
<code>WT</code> from a log-normal distribution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  SEX_ID     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type     <span class="op">=</span> <span class="st">"discrete"</span>, </span>
<span>                    values   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  SUBTYPE_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type     <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    values   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  WT         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type     <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>                    sampling <span class="op">=</span> <span class="st">"log-normal"</span>,</span>
<span>                    values   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70</span>, <span class="fl">.15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subs</span> <span class="op">=</span> <span class="fu"><a href="../reference/mk_subjects.html">mk_subjects</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object</span>,</span>
<span>                   nsub   <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                   covs   <span class="op">=</span> <span class="va">covs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   id TV_F1 TV_ka     TV_CL    TV_Vc    TV_Vp       TV_Q TV_MW TV_BM_IC</span></span>
<span><span class="co">## 1  1 0.744 0.282 -1.609438 1.283708 1.011601 -0.2916901   140     1000</span></span>
<span><span class="co">## 2  2 0.744 0.282 -1.609438 1.283708 1.011601 -0.2916901   140     1000</span></span>
<span><span class="co">## 3  3 0.744 0.282 -1.609438 1.283708 1.011601 -0.2916901   140     1000</span></span>
<span><span class="co">## 4  4 0.744 0.282 -1.609438 1.283708 1.011601 -0.2916901   140     1000</span></span>
<span><span class="co">## 5  5 0.744 0.282 -1.609438 1.283708 1.011601 -0.2916901   140     1000</span></span>
<span><span class="co">## 6  6 0.744 0.282 -1.609438 1.283708 1.011601 -0.2916901   140     1000</span></span>
<span><span class="co">##   TV_kdeg_BM TV_Emax TV_EC50       ETAka       ETACL       ETAVc       ETAVp</span></span>
<span><span class="co">## 1        0.1     100     300 -0.06502712 -0.03374875 -0.29360237  0.18318315</span></span>
<span><span class="co">## 2        0.1     100     300 -0.91950087  0.21719197 -0.07600775  0.11721364</span></span>
<span><span class="co">## 3        0.1     100     300 -0.54876273 -0.38299472 -0.42219488  0.02543533</span></span>
<span><span class="co">## 4        0.1     100     300 -0.05907706  0.23752569  0.01166484  0.02450331</span></span>
<span><span class="co">## 5        0.1     100     300 -0.50282444 -0.27998464 -0.26548086 -0.33995745</span></span>
<span><span class="co">## 6        0.1     100     300 -0.63718821 -0.62728988 -0.59757486 -0.12833066</span></span>
<span><span class="co">##         ETAQ    ETABM_IC      ETAEmax SEX_ID SUBTYPE_ID       WT</span></span>
<span><span class="co">## 1  0.6674704 -0.03311960  0.058217838      1          0 77.83891</span></span>
<span><span class="co">## 2 -1.4290817 -0.09637395 -0.469456427      0          0 72.11971</span></span>
<span><span class="co">## 3 -0.4469244 -0.20538254 -0.558499454      1          0 61.23125</span></span>
<span><span class="co">## 4 -0.3581637 -0.08295268 -0.002047025      0          0 78.62028</span></span>
<span><span class="co">## 5 -0.8159133  0.06642836 -0.045310592      1          0 66.47021</span></span>
<span><span class="co">## 6  1.4513064  0.24280136  0.205796418      1          0 82.88065</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-rules">Creating rules<a class="anchor" aria-label="anchor" href="#creating-rules"></a>
</h3>
<p>The <code>rules</code> are a named list. The list names are arbitrary
and should be used for you to track what is going on. Each of these are
a list with two required elements. A <code>condition</code> and an
<code>action</code>. The condition is should be character string that
when evaluated results in either <code>TRUE</code> or
<code>FALSE</code>. The <code>action</code> should be a list and have a
<code>type</code> and other list elements based on that
<code>type</code>. Shown below is the <code>"dose"</code> type of
action:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  low_dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    condition <span class="op">=</span> <span class="st">"TRUE"</span>,</span>
<span>    true_value  <span class="op">=</span> <span class="st">"3mg"</span>,</span>
<span>    false_value <span class="op">=</span> <span class="st">"0"</span>,</span>
<span>    action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      type  <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>      state     <span class="op">=</span> <span class="st">"Ac"</span>, </span>
<span>      values    <span class="op">=</span> <span class="st">"c(3,  3,  3,  3)*1e6/MW"</span>,</span>
<span>      times     <span class="op">=</span> <span class="st">"c(0, 14, 28, 42)"</span>,</span>
<span>      durations <span class="op">=</span> <span class="st">"c(0,  0,  0,  0)"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can optionally add a <code>true_value</code> and a
<code>false_value</code> that will be stored in the simulated output to
indicate the evaluation status of the condition. When setting a dose
type you need to also provide elements for <code>values</code>,
<code>times</code>, and <code>durations</code>. These are all character
objects that can be evaluated to provide vectors. It’s important to note
the following when providing a dose type of action:</p>
<ul>
<li>The lengths of these should be equal.</li>
<li>Times are relative to the evaluation time point.</li>
</ul>
</div>
<div class="section level3">
<h3 id="evaluation-times">Evaluation times<a class="anchor" aria-label="anchor" href="#evaluation-times"></a>
</h3>
<p>With the subjects and rules defined we need to define the timepoints
where the rules will be evaluated. In this case we are considering 7
cycles (0 to 6) of 8 weeks (2*28) each.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eval_times</span> <span class="op">=</span>  <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">*</span><span class="fl">28</span><span class="op">*</span><span class="fl">2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-simulations">Running simulations<a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h3>
<p>This will define the output times we want for the simulation. Note
that the last evlation point is on day 336 (<code>6*2*8</code>), so we
follow the timecourse out for one more cycle to day 392
(<code>7*2*8</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_times</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">*</span><span class="fl">28</span><span class="op">*</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>If we want to pass any options to <code>rxode2</code> we can do that
by creating a named list with the option name and value paired
together:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rx_options</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   covsInterpolation <span class="op">=</span> <span class="st">"locf"</span>,</span>
<span>   addCov<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Lastly all of these can be passed to
<code><a href="../reference/simulate_rules.html">simulate_rules()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simres</span> <span class="op">=</span> </span>
<span><span class="fu"><a href="../reference/simulate_rules.html">simulate_rules</a></span><span class="op">(</span>object        <span class="op">=</span> <span class="va">object</span>,</span>
<span>               subjects      <span class="op">=</span> <span class="va">subs</span><span class="op">[[</span><span class="st">"subjects"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>               eval_times    <span class="op">=</span> <span class="va">eval_times</span>,</span>
<span>               output_times  <span class="op">=</span> <span class="va">output_times</span>, </span>
<span>               rules         <span class="op">=</span> <span class="va">rules</span>,</span>
<span>               rx_options    <span class="op">=</span> <span class="va">rx_options</span><span class="op">)</span></span></code></pre></div>
<p><img src="clinical_trial_simulation_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-resetting-states">Example Resetting states<a class="anchor" aria-label="anchor" href="#example-resetting-states"></a>
</h2>
<p>The action type <code>"set state"</code> can be used to arbitrarily
set the value of any state in the system. Below we are setting the
central compartment to a value of 10 at time zero. Then at time 56 we
increase the value in the peripheral compartment <code>Cp</code> by a
factor of 5.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  reset_Ac    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   condition <span class="op">=</span> <span class="st">"time == 0"</span>,</span>
<span>   true_flag  <span class="op">=</span> <span class="st">"Ac set"</span>,</span>
<span>   false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>   action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     type     <span class="op">=</span> <span class="st">"set state"</span>,</span>
<span>     state    <span class="op">=</span> <span class="st">"Ac"</span>,</span>
<span>     value    <span class="op">=</span> <span class="st">"10"</span><span class="op">)</span></span>
<span>   <span class="op">)</span>,</span>
<span> reset_Cp    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   condition <span class="op">=</span> <span class="st">"time == 56"</span>,</span>
<span>   true_flag  <span class="op">=</span> <span class="st">"Cp set"</span>,</span>
<span>   false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>   action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     type     <span class="op">=</span> <span class="st">"set state"</span>,</span>
<span>     state    <span class="op">=</span> <span class="st">"Cp"</span>,</span>
<span>     value    <span class="op">=</span> <span class="st">"Cp*5"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">simres</span> <span class="op">=</span> </span>
<span><span class="fu"><a href="../reference/simulate_rules.html">simulate_rules</a></span><span class="op">(</span>object        <span class="op">=</span> <span class="va">object</span>,</span>
<span>               subjects      <span class="op">=</span> <span class="va">subs</span><span class="op">[[</span><span class="st">"subjects"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>               eval_times    <span class="op">=</span> <span class="va">eval_times</span>,</span>
<span>               output_times  <span class="op">=</span> <span class="va">output_times</span>, </span>
<span>               rules         <span class="op">=</span> <span class="va">rules</span>,</span>
<span>               rx_options    <span class="op">=</span> <span class="va">rx_options</span><span class="op">)</span></span></code></pre></div>
<p><img src="clinical_trial_simulation_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="example-manual-code-evaluation">Example: Manual code evaluation<a class="anchor" aria-label="anchor" href="#example-manual-code-evaluation"></a>
</h2>
<p>If you find you need to do something more complicated you can include
functions in the preamble and use those functions in the methods above.
Alternatively you can create your own code and use the
<code>"manual"</code> rule type to modify the event table using the
objects in the rule evaluation environment above. In the code below we
are simply setting a state for the current subject id to a value.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">code</span><span class="op">=</span><span class="st">"</span></span>
<span><span class="st">SI_interval_ev = etRbind(SI_interval_ev,</span></span>
<span><span class="st">et(cmt  = 'Ac',</span></span>
<span><span class="st">   id   = id,</span></span>
<span><span class="st">   amt  = 10,</span></span>
<span><span class="st">   evid = 4,</span></span>
<span><span class="st">   time = time))"</span></span>
<span></span>
<span><span class="va">rules</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  manual_example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    condition <span class="op">=</span> <span class="st">"time == 56"</span>,</span>
<span>    true_flag  <span class="op">=</span> <span class="st">"manual"</span>,</span>
<span>    false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>    action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      type  <span class="op">=</span> <span class="st">"manual"</span>,</span>
<span>      code      <span class="op">=</span> <span class="va">code</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">simres</span> <span class="op">=</span> </span>
<span><span class="fu"><a href="../reference/simulate_rules.html">simulate_rules</a></span><span class="op">(</span>object        <span class="op">=</span> <span class="va">object</span>,</span>
<span>               subjects      <span class="op">=</span> <span class="va">subs</span><span class="op">[[</span><span class="st">"subjects"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>               eval_times    <span class="op">=</span> <span class="va">eval_times</span>,</span>
<span>               output_times  <span class="op">=</span> <span class="va">output_times</span>, </span>
<span>               rules         <span class="op">=</span> <span class="va">rules</span>,</span>
<span>               rx_options    <span class="op">=</span> <span class="va">rx_options</span><span class="op">)</span></span></code></pre></div>
<p><img src="clinical_trial_simulation_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="example-titrated-dosing-of-a-biomarker">Example: Titrated dosing of a biomarker<a class="anchor" aria-label="anchor" href="#example-titrated-dosing-of-a-biomarker"></a>
</h2>
<p>The examples before this demonstrate the mechanics of how to perform
rule-based simualtions. This example should provide a more concrete
demonstration of how to use these elements together. Here we want to
titrate dosing until a biomarker is within a range. Once in that range
we want to maintain that dose. The first rule is only active at time 0
and it will initialize dosing at 0.1 mg. The remaining rules will only
be active after the first dose at time 0 if the biomarker is below the
range (<code>ss_dose_increase</code> ), above the range
(<code>ss_dose_decrease</code>), or in the range
(<code>ss_dose_keep</code>). These each use the simulation internal
function <code>SI_fpd</code> to fetch the previous dose and select the
new dose as a fraction of the previous. If you need to you can create
your own functions to use in the action fields. You just need to create
a character string with the function definitions and pass those as the
<code>preamble</code> input to <code><a href="../reference/simulate_rules.html">simulate_rules()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> first_cycle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   condition <span class="op">=</span> <span class="st">"time == 0"</span>,</span>
<span>   true_flag  <span class="op">=</span> <span class="st">"first cycle"</span>,</span>
<span>   false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>   action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     type  <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>     state     <span class="op">=</span> <span class="st">"Ac"</span>, </span>
<span>     values    <span class="op">=</span> <span class="st">"c(0.1,  0.1,  0.1,  0.1)*1e6/MW"</span>,</span>
<span>     times     <span class="op">=</span> <span class="st">"c(0, 14, 28, 42)"</span>,</span>
<span>     durations <span class="op">=</span> <span class="st">"c(0,  0,  0,  0)"</span><span class="op">)</span></span>
<span>   <span class="op">)</span> ,</span>
<span> ss_dose_keep         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   condition <span class="op">=</span> <span class="st">"((BM &lt;=  7e4) &amp; (BM &gt;=5e4)) &amp; (time &gt; 0)"</span>,</span>
<span>   true_flag  <span class="op">=</span> <span class="st">"keep last"</span>,</span>
<span>   false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>   action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     type  <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>     state     <span class="op">=</span> <span class="st">"Ac"</span>, </span>
<span>     values    <span class="op">=</span> <span class="st">"c( 1.0,  1.00,  1.00,  1.00)*SI_fpd(id=id, state='Ac')"</span>,</span>
<span>     times     <span class="op">=</span> <span class="st">"c(0, 14, 28, 42)"</span>,</span>
<span>     durations <span class="op">=</span> <span class="st">"c(0,  0,  0,  0)"</span><span class="op">)</span></span>
<span>   <span class="op">)</span> ,</span>
<span> ss_dose_decrease     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   condition <span class="op">=</span> <span class="st">"(BM &gt;  7e4) &amp; (time &gt; 0)"</span>,</span>
<span>   true_flag  <span class="op">=</span> <span class="st">"titrate down"</span>,</span>
<span>   false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>   action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     type  <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>     state     <span class="op">=</span> <span class="st">"Ac"</span>, </span>
<span>     values    <span class="op">=</span> <span class="st">"c( .90,   .90,   .90,   .90)*SI_fpd(id=id, state='Ac')"</span>,</span>
<span>     times     <span class="op">=</span> <span class="st">"c(0, 14, 28, 42)"</span>,</span>
<span>     durations <span class="op">=</span> <span class="st">"c(0,  0,  0,  0)"</span><span class="op">)</span></span>
<span>   <span class="op">)</span> ,</span>
<span> ss_dose_increase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   condition <span class="op">=</span> <span class="st">"(BM &lt;  5e4) &amp; (time &gt; 0)"</span>,</span>
<span>   true_flag  <span class="op">=</span> <span class="st">"titrate up"</span>,</span>
<span>   false_flag <span class="op">=</span> <span class="st">""</span>,</span>
<span>   action    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     type  <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>     state     <span class="op">=</span> <span class="st">"Ac"</span>, </span>
<span>     values    <span class="op">=</span> <span class="st">"c(1.30,  1.30,  1.30,  1.30)*SI_fpd(id=id, state='Ac')"</span>,</span>
<span>     times     <span class="op">=</span> <span class="st">"c(0, 14, 28, 42)"</span>,</span>
<span>     durations <span class="op">=</span> <span class="st">"c(0,  0,  0,  0)"</span><span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">simres</span> <span class="op">=</span> </span>
<span><span class="fu"><a href="../reference/simulate_rules.html">simulate_rules</a></span><span class="op">(</span>object        <span class="op">=</span> <span class="va">object</span>,</span>
<span>               subjects      <span class="op">=</span> <span class="va">subs</span><span class="op">[[</span><span class="st">"subjects"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>               eval_times    <span class="op">=</span> <span class="va">eval_times</span>,</span>
<span>               output_times  <span class="op">=</span> <span class="va">output_times</span>, </span>
<span>               rules         <span class="op">=</span> <span class="va">rules</span>,</span>
<span>               rx_options    <span class="op">=</span> <span class="va">rx_options</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 class="tabset" id="simulation-results">Simulation results<a class="anchor" aria-label="anchor" href="#simulation-results"></a>
</h4>
<div class="section level5">
<h5 id="timecourse">Timecourse<a class="anchor" aria-label="anchor" href="#timecourse"></a>
</h5>
<p><img src="clinical_trial_simulation_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
</div>
<div class="section level5">
<h5 id="dosing-values">Dosing values<a class="anchor" aria-label="anchor" href="#dosing-values"></a>
</h5>
<p><img src="clinical_trial_simulation_files/figure-html/unnamed-chunk-26-2.png" width="672"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="antibody-pk-and-biomarker-system">Antibody-PK and biomarker system<a class="anchor" aria-label="anchor" href="#antibody-pk-and-biomarker-system"></a>
</h2>
<pre><code><span><span class="co"># Dosing into Ac and At is in nmoles. So to dose 3 mg you would use 3e6/MW</span></span>
<span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>   <span class="co"># Typical Value of System Parameters </span></span>
<span>   <span class="va">TV_F1</span>           <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.744</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_ka</span>           <span class="op">=</span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.282</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span>   <span class="va">TV_CL</span>           <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.200</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_Vc</span>           <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">3.61</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_Vp</span>           <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">2.75</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_Q</span>            <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.747</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_MW</span>           <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">140</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_BM_IC</span>        <span class="op">=</span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1000</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span>   <span class="va">TV_kdeg_BM</span>      <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.1</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">TV_Emax</span>         <span class="op">=</span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">100.0</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span>   <span class="va">TV_EC50</span>         <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">300</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Between-subject variability:</span></span>
<span>     <span class="va">ETAka</span> <span class="op">+</span>     <span class="va">ETACL</span> <span class="op">+</span>     <span class="va">ETAVc</span> <span class="op">+</span>     <span class="va">ETAVp</span> <span class="op">+</span>     <span class="va">ETAQ</span> <span class="op">+</span>      <span class="va">ETABM_IC</span> <span class="op">+</span>  <span class="va">ETAEmax</span> <span class="op">~</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.416</span>,                                                                         </span>
<span>     <span class="fl">0</span>,          <span class="fl">0.09875</span>,                                                            </span>
<span>     <span class="fl">0</span>,          <span class="fl">0.0786</span>,     <span class="fl">0.116</span>,                                                 </span>
<span>     <span class="fl">0</span>,          <span class="fl">0.0619</span>,     <span class="fl">0.0377</span>,     <span class="fl">0.0789</span>,                                    </span>
<span>     <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0.699</span>,                         </span>
<span>     <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0.05</span>,              </span>
<span>     <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0</span>,          <span class="fl">0.10</span><span class="op">)</span>  </span>
<span></span>
<span>   <span class="co"># Error model parameters</span></span>
<span>   <span class="va">prop_err_PK</span>  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.1</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span>   <span class="va">add_err_PK</span>   <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.1</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span>   <span class="va">add_err_BM</span>   <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.1</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span> </span>
<span>   <span class="co"># System Parameters </span></span>
<span>   <span class="va">F1</span>          <span class="op">=</span> <span class="va">TV_F1</span></span>
<span>   <span class="va">ka</span>          <span class="op">=</span> <span class="va">TV_ka</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETAka</span><span class="op">)</span></span>
<span>   <span class="va">CL</span>          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">TV_CL</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETACL</span><span class="op">)</span></span>
<span>   <span class="va">Vc</span>          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">TV_Vc</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETAVc</span><span class="op">)</span></span>
<span>   <span class="co"># AMTIFY:Cc</span></span>
<span>   <span class="va">Cc</span>          <span class="op">=</span> <span class="va">Ac</span><span class="op">/</span><span class="op">(</span><span class="va">Vc</span><span class="op">)</span></span>
<span>   <span class="va">Vp</span>          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">TV_Vp</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETAVp</span><span class="op">)</span></span>
<span>   <span class="va">Q</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">TV_Q</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETAQ</span><span class="op">)</span></span>
<span>   <span class="va">MW</span>          <span class="op">=</span> <span class="va">TV_MW</span></span>
<span>   <span class="va">BM_IC</span>       <span class="op">=</span> <span class="va">TV_BM_IC</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETABM_IC</span><span class="op">)</span></span>
<span>   <span class="va">kdeg_BM</span>     <span class="op">=</span> <span class="va">TV_kdeg_BM</span></span>
<span>   <span class="va">Emax</span>        <span class="op">=</span> <span class="va">TV_Emax</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ETAEmax</span><span class="op">)</span></span>
<span>   <span class="va">EC50</span>        <span class="op">=</span> <span class="va">TV_EC50</span></span>
<span></span>
<span>   <span class="va">Dinf</span>        <span class="op">=</span> <span class="fl">0.0</span></span>
<span></span>
<span>   <span class="co"># Static Secondary Parameters </span></span>
<span>   <span class="va">WTTV</span>        <span class="op">=</span> <span class="fl">70</span> </span>
<span>   <span class="va">CL_IND</span>      <span class="op">=</span> <span class="va">CL</span><span class="op">*</span><span class="op">(</span><span class="fl">1.0</span><span class="op">+</span><span class="va">SEX_ID</span><span class="op">*</span><span class="fl">.1</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1.0</span><span class="op">+</span><span class="va">SUBTYPE_ID</span><span class="op">*</span><span class="fl">.1</span><span class="op">)</span> </span>
<span>   <span class="va">kel</span>         <span class="op">=</span> <span class="va">CL_IND</span><span class="op">/</span><span class="va">Vc</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">WT</span><span class="op">/</span><span class="va">WTTV</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">0.35</span><span class="op">)</span> </span>
<span>   <span class="va">kcp</span>         <span class="op">=</span> <span class="va">Q</span><span class="op">/</span><span class="va">Vc</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">WT</span><span class="op">/</span><span class="va">WTTV</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">0.35</span><span class="op">)</span> </span>
<span>   <span class="va">kpc</span>         <span class="op">=</span> <span class="va">Q</span><span class="op">/</span><span class="va">Vp</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">WT</span><span class="op">/</span><span class="va">WTTV</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">0.35</span><span class="op">)</span> </span>
<span>   <span class="va">ksyn_BM</span>     <span class="op">=</span> <span class="va">kdeg_BM</span><span class="op">*</span><span class="va">BM_IC</span> </span>
<span></span>
<span>   <span class="co"># Dynamic Secondary Parameters </span></span>
<span>   <span class="va">STIM</span>        <span class="op">=</span> <span class="fl">1.0</span><span class="op">+</span> <span class="va">Emax</span><span class="op">*</span><span class="va">Cc</span><span class="op">/</span><span class="op">(</span><span class="va">EC50</span><span class="op">+</span><span class="va">Cc</span><span class="op">)</span> </span>
<span></span>
<span>   <span class="co"># Defining ODEs</span></span>
<span>   <span class="fu">BM</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>       <span class="op">=</span> <span class="va">BM_IC</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">At</span><span class="op">)</span>    <span class="op">=</span> <span class="op">(</span><span class="op">-</span><span class="va">ka</span><span class="op">*</span><span class="va">At</span><span class="op">)</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">Ac</span><span class="op">)</span>    <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">ka</span><span class="op">*</span><span class="va">At</span><span class="op">*</span><span class="va">F1</span><span class="op">/</span><span class="va">Vc</span>  <span class="op">-</span><span class="va">kel</span><span class="op">*</span><span class="va">Cc</span> <span class="op">-</span> <span class="va">kcp</span><span class="op">*</span><span class="va">Cc</span>  <span class="op">+</span> <span class="va">kpc</span><span class="op">*</span><span class="va">Cp</span><span class="op">*</span><span class="va">Vp</span><span class="op">/</span><span class="va">Vc</span> <span class="op">+</span> <span class="va">Dinf</span><span class="op">/</span><span class="va">Vc</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">Vc</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">Cp</span><span class="op">)</span>    <span class="op">=</span> <span class="op">(</span><span class="va">kcp</span><span class="op">*</span><span class="va">Cc</span><span class="op">*</span><span class="va">Vc</span><span class="op">/</span><span class="va">Vp</span> <span class="op">-</span> <span class="va">kpc</span><span class="op">*</span><span class="va">Cp</span><span class="op">)</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">BM</span><span class="op">)</span>    <span class="op">=</span> <span class="va">ksyn_BM</span><span class="op">*</span><span class="va">STIM</span><span class="op">-</span><span class="op">(</span><span class="va">kdeg_BM</span><span class="op">*</span><span class="va">BM</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Outputs and error models</span></span>
<span>   <span class="va">C_ng_ml</span>     <span class="op">=</span> <span class="va">Cc</span><span class="op">*</span><span class="va">MW</span></span>
<span>   <span class="va">C_ng_ml</span> <span class="op">~</span> <span class="fu">add</span><span class="op">(</span><span class="va">add_err_PK</span><span class="op">)</span> <span class="op">+</span> <span class="fu">prop</span><span class="op">(</span><span class="va">prop_err_PK</span><span class="op">)</span></span>
<span></span>
<span>   <span class="va">BM_obs</span>      <span class="op">=</span> <span class="va">BM</span></span>
<span>   <span class="va">BM_obs</span>  <span class="op">~</span> <span class="fu">add</span><span class="op">(</span><span class="va">add_err_BM</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
